#!/usr/bin/env python

import argparse as ap
import pandas as pd
import numpy as np


def parse_args():
    parser = ap.ArgumentParser()
    parser.add_argument(
        '--input',
        '-i',
        required = True,
        help = 'clustersize stats file as generated by spritefridge pairs'
    )
    parser.add_argument(
        '--output',
        '-o',
        required = True,
        help = 'name of the outputfile to write the binned stats to'
    )
    return parser.parse_args()


def bins_and_labels():
    bins = list(
        np.logspace(
            0, 3, 4, 
            base = 10, 
            dtype = int
        )
    )
    labels = ['singlets', '2-10', '11-100', '101-1000', '>1000']
    return [0] + bins + [1e30], labels


def main():
    args = parse_args()
    bins, labels = bins_and_labels()
    stats = pd.read_csv(
        args.input,
        sep = '\t',
        header = None,
        names = ['size', 'count']
    )
    stats['bins'] = pd.cut(
        stats['size'],
        bins = bins,
        labels = labels
    )
    aggregated_stats = stats \
        .groupby('bins') \
        .sum() \
        .reset_index()
    
    aggregated_stats \
        .loc[:, ['bins', 'count']] \
        .to_csv(
            args.output,
            header = False,
            index = False
        )


if __name__ == '__main__':
    main()